# Data Engineering Code Interview

## üëã Hi there

Welcome to the Data Engineering code interview! This small data challenge is designed to test out your skills in python, sql, git, and geospatial data processing. The challenge will go from easy to difficult, there's no preassure to finish all the tasks, so try your best and get as far as you can!

To start this challenge, create a new **private** repo under your github username. We would like you to include all the code, notes, visualizations, and data inside of the repo. You will have **48 hours** to complete this data challenge. Once you are done, please provide read access to your repo by inviting `@SashaWeinstein`, `@mbh329`, and `@AmandaDoyle`

> ‚ö†Ô∏è Note: **the repo has to be <ins>private</ins>, otherwise you will be automatically <ins>disqualified</ins>**. Also we will check your commit timestamp to only account for the first 48 hours of coding activities.

## What we are looking for

Your code interview will be evaluated based on your repo, so make sure all files you have are stored in your repo. Specifically we are looking at:

- **Project scafolding**: How you name, manage, and organize your files.
- **Reproducibility**:
  - Ideally if it runs on your machine, it would also run on mine.
  - Make sure you document any software dependency, and installation process.
- **Code**:
  - Clean
  - Readable
  - DRY (Don't Repeat Yourself)
- **Documentation**:
  - A comprehensive `README.md` on anything that we should know about this repo.
  - Clear instructions on commands to run code and what to expect.
  - Clear documentation for functions/processes in code.
- **Project Management**:
  - We want to see how you manage a multi-part project and how you break down the tasks.
  - Feel free to open up issues for yourself / make pull requests and etc so that your code progress is captured and documented.
  - We highly **discourage** lumpped commits.

## Table of Content

- [Introduction](#introduction)
  - [Task 1: Data Download](#task-1-data-download)
  - [Task 2: Data Aggregation](#task-2-data-aggregation)
  - [Task 3: Data Visualization](#task-3-data-visualization)
  - [Task 4: Spatial Data Processing](#task-4-spatial-data-processing)
  - [Task 5: SQL](#task-5-sql)
  - [Task 6: Spatial SQL](#task-6-spatial-sql)
- [Resources](#resources)

## Introduction

The challenge has two halves, a python/bash half with 4 steps and a docker/SQL half with 2 steps. The second half will use a file generated by the first python step. 

### Python/bash expectations
The logic to perform each step should be written in python, and be callable by an executable script that takes the arguments.  

We love the NYC 311 service and the open data products that come with it. In this challenge, you will use **[311 Service Requests from 2010 to Present](https://data.cityofnewyork.us/Social-Services/311-Service-Requests-from-2010-to-Present/erm2-nwe9)** on NYC Open Data, write an ETL pipeline, and produce some data insight.


### Python Task 1: Data Download

Write a process to download all service request records created in the last *x* days with a certain responding agency. It should take the number of days and responding agency acronym as parameters passed from the command line. Save the service requests in the last seven days with HPD as the responding agnecy and a second different pull of the data in two adequatly named csv files in a folder called `data`.

### Python Task 2: Data Aggregation

Write a process to produce a time series table based on the data you've pulled so far. It should have the following fields

- `created_time`: the timestap of request creation by date and hour OR just date
- `complaint_type`: the type of the complaint (optional)
- `count`: the count of service requests by `complaint_type` by `created_date_hour`

The granularity of the `created_time` column and whether the data is broken down by complaint type should be controlled by parameters passed in from the command line. 

Create as many versions of this table that you think is appropriate to show that your code works, and store these versions as appropriately named .csv files.

### Python Task 3: Data Visualization

Write a bash/python process to create a line plot to show the total service request counts by `created_time` that breaks down the data by `complaint_type` if that column is present. Save as many `.png` files of your plots as you think is necessary to show us that your code works. 
If you would like to go back and download different tables to visualize, that's totally fine. Chose whichever pulls you think make it easiest to show us your work. 

### Python Task 4: Spatial data processing

At Data Engineering, we enhance datasets with geospatial attributes, such as point locations and administrative boundaries. To help us better understand the data from **Python Task 1**, we would like you to join the initial raw data to the some NYC administraive boundary of your chosing. Then create a choropleth map of count of complaints of a specific `complaint_type` of your choice.

Depending on how you generate the map, you can store the map as a `.png` or `.html` under the `data` folder. Please add a title that accurately tells the reader what they are looking at.


### SQL/Docker Task 1: Build container and load 

We ‚ù§Ô∏è SQL and docker! At Data Engineering, we work with database containers a lot and we write a lot of fast and simple ETL pipelines using SQL. In this task, you will:

- Set up POSTGIS container using an image
- Load the `data/raw.csv` into the database and name the table `sample_311`. Make sure this process is captured in a script.
- Perform the same aggregation in **Task 2** in SQL and store the results in a table (same name as the corresponding csv file).

### SQL/Docker Task 2: Spatial SQL

A lot of popular databases have geospatial extensions, which makes spatial data processing in SQL super easy to use. In this task you will:

- Load the adminstrative data you used in python task 4 to the database as a spatial table
- Do a spatial join in SQL between `sample_311` and the administrative boundaries and add a corresponding column to `sample_311`
- Perform the same aggregation in **Task 4** and store the result in a table.
- **Bonus**: export the table with NTA geometry and complaint count into a shapefile under the `data` folder.  


## Resources

- Reach out to Sasha (aweinstein @ planning.nyc.gov) if you have any questions. We love people who ask questions.
- [PostgreSQL Installation Guide](https://www.postgresql.org/download/)
- [Postgis Docker image](https://registry.hub.docker.com/r/postgis/postgis/)
- [Postgis Installation Guide](https://postgis.net/workshops/postgis-intro/installation.html)
- [DigitalOcean Managed Database](https://www.digitalocean.com/products/managed-databases/)

> DigitalOcean is great if you have a lot of trouble with installation, and it offers 100$ of free credit
